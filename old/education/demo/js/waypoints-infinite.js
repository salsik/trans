// Generated by CoffeeScript 1.6.2
/*
Infinite Scroll Shortcut for jQuery Waypoints - v2.0.3
Copyright (c) 2011-2013 Caleb Troughton
Dual licensed under the MIT license and GPL license.
https://github.com/imakewebthings/jquery-waypoints/blob/master/licenses.txt
*/


(function() {
  (function(root, factory) {
    if (typeof define === 'function' && define.amd) {
      return define(['jquery', 'waypoints'], factory);
    } else {
      return factory(root.jQuery);
    }
  })(this, function($) {
    var defaults;

    defaults = {
      container: 'auto',
      items: '.infinite-item',
      more: '.infinite-more-link',
      offset: 'bottom-in-view',
      loadingClass: 'infinite-loading',
      onBeforePageLoad: $.noop,
      onAfterPageLoad: $.noop
    };
    return $.waypoints('extendFn', 'infinite', function(options) {
      var $container;

      options = $.extend({}, $.fn.waypoint.defaults, defaults, options);
//      if ($(options.more).length === 0) {
//        return this;
//      }
      $container = options.container === 'auto' ? this : $(options.container);
      options.handler = function(direction) {
        var $this;

        if (direction === 'down' || direction === 'right') {
          $this = $(this);
          options.onBeforePageLoad(options);

          $this.waypoint('disable');
          $container.addClass(options.loadingClass);
          var moreLink = (options.moreLink) ? options.moreLink : $(options.more).attr('href');
          return $.get(moreLink, function(data) {
            var $data, $more, $newMore;

            $container.removeClass(options.loadingClass);
            $return = options.onAfterPageLoad(data, options);

            if($return===true) {
              $this.waypoint('enable');
            } else if($return===false) {
              $this.waypoint('destroy');
            }
            return $return;
          }, 'json');
        }
      };
      return this.waypoint(options);
    });
  });

}).call(this);
